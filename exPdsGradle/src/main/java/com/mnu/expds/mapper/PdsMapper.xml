<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mnu.expds.mapper.PdsMapper">
	<!--  전체 카운트 -->
	<select id="pdsCount" resultType="int">
		select count(*) from tbl_pds
	</select>

	<!-- 전체 자료 수(검색 O) -->
	<select id="pdsCountSearch" resultType="int">
		select count(*) from tbl_pds where
			<choose>
				<when test="search=='name'">
					name like concat('%',#{key},'%')
				</when>
				<when test="search=='subject'">
					subject like concat('%',#{key},'%')
				</when>
				<when test="search=='contents'">
					contents like concat('%',#{key},'%')
				</when>
			</choose>	
	</select>
	
	<!-- 전체목록 -->
	<select id="pdsList" resultType="com.mnu.expds.domain.PdsDTO">
		select * from tbl_pds order by idx desc
	</select>

	<!-- 전체 자료(검색 O, 페이지 O) -->
	<select id="pdsListSearchPage" resultType="com.mnu.exboard.domain.PdsDTO">
		select * from tbl_pds where
			<choose>
				<when test="search=='name'">
					name like concat('%',#{key},'%')
				</when>
				<when test="search=='subject'">
					subject like concat('%',#{key},'%')
				</when>
				<when test="search=='contents'">
					contents like concat('%',#{key},'%')
				</when>
			</choose>	
		order by idx desc limit #{startpage},#{maxlist}
	</select>
	
	<!-- 등록 -->
	<insert id="pdsWrite">
		insert into tbl_pds(name, subject, contents, pass, filename)
					values(#{name},#{subject},#{contents},#{pass},#{filename})
	</insert>

	<!-- 게시글 조회수 증가 -->
	<update id="pdsHits" >
		update tbl_pds set readcnt = readcnt + 1 
						where idx=#{idx}
	</update>

	<!-- view, modify -->
	<select id="pdsSelect" resultType="com.mnu.expds.domain.PdsDTO">
		select * from tbl_pds where idx=#{idx}
	</select>

	<!--  수정 -->
	<update id="pdsModify">
		update tbl_pds set subject=#{subject}, contents=#{contents},
				filename=#{filename} where idx=#{idx} and pass=#{pass}
	</update>

	<!-- 게시글 삭제 -->
	<delete id="pdsDelete" >
		delete from tbl_pds where idx=#{idx} and pass=#{pass}
	</delete>
	

</mapper>